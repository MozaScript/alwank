<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ألوانك</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Pacifico&display=swap');
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #f0f0f0;
    }
    h1 {
        font-family: 'Pacifico', cursive;
        margin: 10px 0;
        font-size: 3em;
        color: #ff6347;
    }
    #canvasContainer {
        border: 1px solid #333;
        width: 95vw;
        height: 80vh;
        overflow: hidden;
        position: relative;
        touch-action: none;
        background-color: #fff;
    }
    #canvas {
        display: block;
        transform-origin: 0 0;
    }
    .controls {
        margin: 5px;
        width: 95%;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }
    .controls label, .controls button {
        margin: 5px;
        padding: 5px 10px;
    }
</style>
</head>
<body>

<h1>ألوانك</h1>
<div class="controls">
    <label>اللون: <input type="color" id="colorPicker" value="#ff0000"></label>
    <label>حجم القلم: <input type="range" id="sizePicker" min="1" max="50" value="5"></label>
    <label>الأداة:
        <select id="toolPicker">
            <option value="brush">قلم</option>
            <option value="eraser">ممحاة</option>
            <option value="line">خط</option>
            <option value="rect">مربع</option>
            <option value="circle">دائرة</option>
            <option value="triangle">مثلث</option>
        </select>
    </label>
    <button id="undoBtn">Undo</button>
    <button id="redoBtn">Redo</button>
    <button id="clearBtn">امسح كل شيء</button>
    <button id="saveBtn">حفظ PNG</button>
    <button id="zoomIn">+</button>
    <button id="zoomOut">-</button>
</div>

<div id="canvasContainer">
    <canvas id="canvas"></canvas>
</div>

<script>
const container = document.getElementById('canvasContainer');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

const colorPicker = document.getElementById('colorPicker');
const sizePicker = document.getElementById('sizePicker');
const toolPicker = document.getElementById('toolPicker');
const clearBtn = document.getElementById('clearBtn');
const undoBtn = document.getElementById('undoBtn');
const redoBtn = document.getElementById('redoBtn');
const saveBtn = document.getElementById('saveBtn');
const zoomIn = document.getElementById('zoomIn');
const zoomOut = document.getElementById('zoomOut');

canvas.width = 2000;
canvas.height = 2000;

let scale = 1;
let drawing = false;
let startX = 0;
let startY = 0;
let lastX = 0;
let lastY = 0;

// تخزين الرسم للـ Undo / Redo
let history = [];
let historyStep = -1;

function saveState() {
    history = history.slice(0, historyStep + 1);
    history.push(canvas.toDataURL());
    historyStep++;
}

function undo() {
    if (historyStep <= 0) return;
    historyStep--;
    let img = new Image();
    img.src = history[historyStep];
    img.onload = () => ctx.drawImage(img,0,0);
}

function redo() {
    if (historyStep >= history.length -1) return;
    historyStep++;
    let img = new Image();
    img.src = history[historyStep];
    img.onload = () => ctx.drawImage(img,0,0);
}

// الرسم الحر والممحاة
function drawBrush(x, y) {
    ctx.strokeStyle = colorPicker.value;
    ctx.lineWidth = sizePicker.value / scale;
    ctx.lineCap = 'round';
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(x, y);
    ctx.stroke();
    lastX = x;
    lastY = y;
}

// أدوات الأشكال الهندسية
function drawShape(x, y, tool) {
    ctx.strokeStyle = colorPicker.value;
    ctx.lineWidth = sizePicker.value / scale;
    const w = x - startX;
    const h = y - startY;
    if(tool === 'line') {
        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.lineTo(x, y);
        ctx.stroke();
    } else if(tool === 'rect') {
        ctx.strokeRect(startX, startY, w, h);
    } else if(tool === 'circle') {
        ctx.beginPath();
        const radius = Math.sqrt(w*w + h*h);
        ctx.arc(startX, startY, radius, 0, Math.PI*2);
        ctx.stroke();
    } else if(tool === 'triangle') {
        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.lineTo(startX + w, startY + h);
        ctx.lineTo(startX - w, startY + h);
        ctx.closePath();
        ctx.stroke();
    }
}

// التحكم بالزوم
function render() {
    canvas.style.transform = `scale(${scale})`;
    requestAnimationFrame(render);
}
render();

function getCoords(e) {
    const rect = canvas.getBoundingClientRect();
    if(e.touches) {
        const t = e.touches[0];
        return [(t.clientX - rect.left)/scale, (t.clientY - rect.top)/scale];
    } else {
        return [(e.clientX - rect.left)/scale, (e.clientY - rect.top)/scale];
    }
}

// أحداث الفأرة
canvas.addEventListener('mousedown', e => {
    [startX,startY] = getCoords(e);
    lastX = startX;
    lastY = startY;
    drawing = true;
});
canvas.addEventListener('mousemove', e => {
    if(!drawing) return;
    const [x,y] = getCoords(e);
    if(toolPicker.value === 'brush') drawBrush(x,y);
    else if(toolPicker.value === 'eraser') {
        ctx.strokeStyle = '#fff';
        drawBrush(x,y);
    }
});
canvas.addEventListener('mouseup', e => {
    if(!drawing) return;
    const [x,y] = getCoords(e);
    if(['line','rect','circle','triangle'].includes(toolPicker.value))
        drawShape(x,y,toolPicker.value);
    drawing = false;
    saveState();
});
canvas.addEventListener('mouseout', ()=> drawing=false);

// اللمس للموبايل
canvas.addEventListener('touchstart', e => { [startX,startY] = getCoords(e); lastX=startX; lastY=startY; drawing=true; }, {passive:false});
canvas.addEventListener('touchmove', e => { e.preventDefault(); if(!drawing) return; const [x,y]=getCoords(e); if(toolPicker.value==='brush') drawBrush(x,y); else if(toolPicker.value==='eraser'){ ctx.strokeStyle='#fff'; drawBrush(x,y); } }, {passive:false});
canvas.addEventListener('touchend', ()=> { drawing=false; saveState(); });

// المسح
clearBtn.addEventListener('click', ()=>{ ctx.clearRect(0,0,canvas.width,canvas.height); saveState(); });

// Undo / Redo
undoBtn.addEventListener('click', undo);
redoBtn.addEventListener('click', redo);

// حفظ PNG
saveBtn.addEventListener('click', ()=>{ 
    const link = document.createElement('a');
    link.download = 'myDrawing.png';
    link.href = canvas.toDataURL();
    link.click();
});

// الزوم
zoomIn.addEventListener('click', ()=> scale*=1.2);
zoomOut.addEventListener('click', ()=> scale/=1.2);

</script>
</body>
</html>
